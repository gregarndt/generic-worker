{"name":"Generic-worker","tagline":"A generic worker for task cluster, written in go","body":"# generic-worker\r\nA generic worker for task cluster, written in go.\r\n\r\n# Getting started with Generic Worker\r\n\r\nAlthough the generic worker is not yet fully implemented, or feature complete, here is some information about how you might use it when it is ready. This might also serve as a useful guide if you interested in contributing to its development.\r\n\r\n## Install go compiler\r\n\r\nHead over to http://golang.org/doc/install and follow the instructions for your platform. Be sure to set your GOPATH to something appropriate.\r\n\r\n## Install generic worker\r\n\r\n```\r\ngo get github.com/petemoore/generic-worker\r\n```\r\n\r\n## Create TaskCluster account\r\n\r\nHead over to https://tools.taskcluster.net/auth/ and create yourself an account with scopes `*` and a decently long expiry for running jobs. Keep a note of the ClientId and AccessToken you are given.\r\n\r\n## Set up your env\r\n\r\n```\r\nexport PAYLOAD_SCHEMA=\"${GOPATH}/src/github.com/petemoore/generic-worker/schema.json\"\r\nexport PROVISIONER_ID='<choose_whatever_you_like>'\r\nexport REFRESH_URLS_PREMATURELY_SECS=300\r\nexport TASKCLUSTER_ACCESS_TOKEN='<your_access_token_from_above>'\r\nexport TASKCLUSTER_CLIENT_ID='<your_client_id_from_above>'\r\nexport WORKER_GROUP='<anything>'\r\nexport WORKER_ID='<something_to_identify_your_machine_eg_hostname>'\r\nexport WORKER_TYPE='<choose_whatever_you_like>'\r\n```\r\n\r\nYou may also consider putting this in a file that is sourced when your shell starts.\r\n\r\n## Start the generic worker\r\n\r\nSimply run:\r\n\r\n```\r\ngeneric-worker\r\n```\r\n\r\nand watch logs for a successful startup. If you can see it is polling the Queue, and the process does not exit, then you can continue. If it reports a problem, follow any instructions it provides. If you are really stuck, join #taskcluster channel on irc.mozilla.org, and ask for help.\r\n\r\nIt should look something like this:\r\n\r\n```\r\npmoore@laptop:~ $ generic-worker\r\n2015/03/27 15:39:55   Delete URL: https://taskclusterqueuev1.queue.core.windows.net/queue-uxvv56u25c7cwivco6vq-uxvv56ykfoi6u-1/messages/{{messageId}}?popreceipt={{popReceipt}}&st=2015-04-20T13%3A24%3A55Z&se=2015-04-20T14%3A09%3A55Z&sp=p&sv=2014-02-14&sig=hQvrbc5zPVsaHFZ9EA5JpTl0OedEt20ED3I2wnt9AAw%3D\r\n2015/03/27 15:39:55   Poll URL:   https://taskclusterqueuev1.queue.core.windows.net/queue-uxvv56u25c7cwivco6vq-uxvv56ykfoi6u-1/messages?visibilitytimeout=300&st=2015-04-20T13%3A24%3A55Z&se=2015-04-20T14%3A09%3A55Z&sp=p&sv=2014-02-14&sig=hQvrbc5zPVsaHFZ9EA5JpTl0OedEt20ED3I2wnt9AAw%3D\r\n2015/03/27 15:39:56 Zero tasks returned in Azure XML QueueMessagesList\r\n2015/03/27 15:39:56 No task claimed from any Azure queue...\r\n2015/03/27 15:39:56 Zero tasks returned in Azure XML QueueMessagesList\r\n2015/03/27 15:39:56 No task claimed from any Azure queue...\r\n2015/03/27 15:39:57 Zero tasks returned in Azure XML QueueMessagesList\r\n2015/03/27 15:39:57 No task claimed from any Azure queue...\r\n2015/03/27 15:39:58 Zero tasks returned in Azure XML QueueMessagesList\r\n2015/03/27 15:39:58 No task claimed from any Azure queue...\r\n\r\n```\r\n\r\n## Create a test job\r\n\r\nGo to https://tools.taskcluster.net/task-creator/ and create a task to run on your generic worker.\r\n\r\nThis page provides a decent example task, but first make sure to edit `provisionerId` value should match what you set your `PROVISIONER_ID` env variable to, and the value of `workerType` should match what you set your `WORKER_TYPE` env variable to.\r\n\r\nPlease note you should *NOT* use the default value of `aws-provisioner` for the `provisionerId` since then the production aws provisioner may start spawning ec2 instances, and the docker-worker may try to run the job. By specifying something unique for your local environment, the aws provisioner and docker workers will leave this task alone, and only your machine will claim the task.\r\n\r\nDon't forget to submit the task by clicking the *Create Task* icon.\r\n\r\nIf all is well, your local generic worker should pick up the job you submit, run it, and report back status.\r\n\r\n*Please note the Generic Worker is still undergoing development, and is not complete yet.*\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}